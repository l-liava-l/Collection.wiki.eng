Итерационные методы Collection могут принимать специальный объект дополнительных условий для операции. Набор параметров практически идентичен для всех методов и образует «единый интерфейс итераторов».

## Список параметров

* [filter](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#filter)
* [id](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#id)
* [mult](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#mult)
* [count](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#count)
* [from](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#from)
* [startIndex](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#startindex)
* [endIndex](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#endindex)
* [reverse](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#reverse)
* [inverseFilter](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#inversefilter)
* [notOwn](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#notown)
* [live](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#live)
* [use](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#use)
* [vars](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#vars)
* [context](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#context)
* [chain](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#chain)

### filter

```js
/**
 * @type {function(this:Collection, ?, ?, !Object, number, function(?boolean=): number, !Function): ?|string|boolean}
 * @typedef $$CollectionFilter
 * @default 'active'
 */
```

Параметр задаёт фильтр, который проверяет элементы исходной коллекции и отсеивает те, которые не подходят под заданное условие.

Если функция-фильтр возвращает «отрицательное» значение (`false`, `undefined`, `null`, `''`, `0` и т.д.), то считается, что элемент не подходит.

#### Фильтр как функция

Фильтр может быть задан как простая функция, которая имеет следующие входные параметры:

1. `el` — ссылка на текущий элемент коллекции
2. `key` — ключ текущего элемента (для Set всегда равен `null`)
3. `data` — ссылка на исходную коллекцию
4. `i` — итерационный индекс, т.е. числовой номер элемента коллекции в текущей итерации
5. `length` — функция, которая возвращает длину текущей коллекции (вызов кешируется)
	
	*Функция может принимать один входной параметр: если он равен `true`, то длина коллекции вычисляется заново без учёта кеша.*

6. `callee` — ссылка на саму функцию callback

**this** внутри фильтра всегда указывает на исходный объект-экземпляр Collection, поэтому для передачи своего this
необходимо использовать `.bind` (не желательно, т.к. работает очень медленно), `arrow function` или переменные замыкания.

```js
$C([1, 2, 3]).get(() => {
	this.
});

var that = this;

$C([1, 2, 3]).get(function (el) {
	that.
});

$C([1, 2, 3]).get(function (el) {
	this.
}.bind(this));
```

#### Фильтр как строка

Фильтр может быть также задан в виде строки с помощью указания / комбинирования ИД.

```js
// Добавим 2 глобальных фильтра
$C().addFilter({
	'odd': function () { ... },
	'unique': function () { ... }
});

$C([1, 2, 3, 2, 4]).get('odd') // [2, 4]
$C([1, 2, 3, 2, 4]).get('odd && unique') // [4]
```

При задании фильтров в виде строки можно использовать операторы группировки `()`, а также: `&&`, `||`, `!`.

```js
$C([1, 2, 3, 2, 4]).get('(filter1 || filter2) && !filter3');
```

##### Строковое сокращение

Ещё один вид представление фильтра — это строковое сокращение, более короткая форма записи функции.

```js
$C([1, 2, 3, 2, 4]).get(':el % 2 === 0');
```

Такое строковое сокращение эквивалентно

```js
$C([1, 2, 3, 2, 4]).get(function (el) { return el % 2 === 0; });
```

Строковое сокращение должно начинаться с символа `:`.
Также есть некоторые «ограничения»:

* Строковые сокращения являются глобальными функциями, т.е. не имеют доступа к переменным замыкания;
* Т.к. запись `:` по сути является `return`, то внутри строковых сокращений нельзя создавать переменные, использовать блоки и т.д;
* Имена входных параметров функции являются константными и равны:

```js
el
key
data
i
length
callee
```

**this** также, как и в простых функциях, ссылается на исходный экземпляр Collection.

Допускается одновременное использование строковых сокращений и фильтров по ИД,
но для этого сокращение нужно обязательно взять в скобки.

```js
$C([1, 2, 3, 2, 4]).get('(:el % 2 === 0) && odd');
```

Сокращения удобно использовать внутри шаблонов, т.к. они позволяют писать более короткий и наглядный код,
а также дополнительным бонусом является то, что они почти всегда "инлайнятся" JIT компилятором Collection
(не возможен инлайнинг, если внутри сокращения используется callee),
что позволяет очень сильно оптимизировать скорость работы итератора.

###### Переменные внутри строковых сокращений

Для передачи параметров в строковое сокращение в Collection существует API переменных.

```js
$C().addVar('foo', 1);
$C([1, 2, 3, 4]).get(':el > this.getVar("foo")') // [2, 3, 4] 
```

Также для доступа к значению переменной в строковом сокращении существует более короткая форма записи.

```js
$C().addVar('foo', 1);
$C([1, 2, 3, 4]).get(':el > ${foo})') // [2, 3, 4] 
```

#### Фильтр как логическое значение

Если фильтр равен `true`, то на итератор не накладывают никакие фильтры (включая активные).

#### Специальные константы фильтра

Фильтр может возвращать специальные значения Collection `TRUE` и `FALSE`.

```js
$C().addFilter('foo1', function () { return this.TRUE; });

// Константа this.TRUE означает, что фильтр всегда возвращает положительный результат
$C([1, 2, 3]).get('foo1') // [1, 2, 3]
$C([1, 2, 3]).get('!foo1') // [1, 2, 3]

$C().addFilter('foo2', function () { return this.FALSE; });

// Константа this.FALSE означает, что фильтр всегда возвращает отрицательный результат
$C([1, 2, 3]).get('foo2') // []
$C([1, 2, 3]).get('!foo2') // []
```

Константы также имеют глобальные ссылки:

* `Collection.prototype.TRUE` `$cTRUE` 
* `Collection.prototype.FALSE` `$cFALSE` 

```js
$C().addFilter('foo1', function () { return $cTRUE; });

$C([1, 2, 3]).get('foo1') // [1, 2, 3]
$C([1, 2, 3]).get('!foo1') // [1, 2, 3]

$C().addFilter('foo2', function () { return $cFALSE; });

$C([1, 2, 3]).get('foo2') // []
$C([1, 2, 3]).get('!foo2') // []
```

### id

```js
/**
 * @type {string}
 * @default 'active'
 */
```

Параметр **id** позволяет задать ИД исходной коллекции, если в одном экземпляре содержится несколько коллекций.

```js
var db = new Collection();

db.addCollection('foo', [1, 2, 3]);
db.get({id: 'foo'}); // [1, 2, 3]
```

### mult

```js
/**
 * @type {boolean}
 * @default true
 */
```

Если параметр равен `false`, то после первой успешной итерации операция сбрасывается.
Также некоторые методы в этом случае могут возвращать отличный результат, например,
[get](https://github.com/kobezzza/Collection/wiki/get) вернёт сам элемент, а не массив с элементами.

```js
$C([1]).get() // [1]
$C([1]).get({mult: false}) // 1
```

### count

```js
/**
 * @type {number}
 */
```

Параметр **count** задаёт максимальное количество подходящих под условие элементов.
После достижения нужного количество операция сбрасывается.

```js
$C([1, 2, 3, 4]).get({count: 2}) // [1, 2]
$C([1, 2, 3, 4]).get({count: 2, filter: ':el > 1'}) // [2, 3]
```

### from

```js
/**
 * @type {number}
 * @default 0
 */
```

Параметр **from** задаёт количество пропускаемых подходящих под условие элементов.

```js
$C([1, 2, 3, 4]).get({from: 1}) // [2, 3, 4]
$C([1, 2, 3, 4]).get({from: 1, filter: ':el > 1'}) // [3, 4]
```

### startIndex

```js
/**
 * @type {number}
 * @default 0
 */
```

Параметр **startIndex** задаёт номер итерационного индекса, с которого начинается обход.

```js
$C([1, 2, 3, 4]).get({startIndex: 1}) // [2, 3, 4]
```

В отличии от параметра [count](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#count), который задаёт количество «пропускаемых» элементов, параметр startIndex задаёт точку начала операции, т.е. все элементы «до» никак не участвуют в операции.

```js
$C([1, 2, 3, 4]).get({startIndex: 1, from: 1, filter: ':el < 4'}) // [3]
```

### endIndex

```js
/**
 * @type {number}
 */
```

Параметр **endIndex** задаёт номер последнего итерационного индекса, который участвует в обходе, т.е. после  операция будет сброшена.

```js
$C([1, 2, 3, 4]).get({endIndex: 2}) // [1, 2, 3]
```

### reverse

```js
/**
 * @type {boolean}
 * @default false
 */
```

Если параметр равен `true`, то обход коллекции идёт с конца.

```js
$C([1, 2, 3]).get() // [1, 2, 3]
$C([1, 2, 3]).get({reverse: true}) // [3, 2, 1]
```

При указании параметров [startIndex](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#startindex) и [endIndex](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#endindex) совместно с *reverse* отчёт также идёт с нуля, т.е.

```js
$C([1, 2, 3, 4, 5]).get({startIndex: 1, endIndex: 3, reverse: true}) // [4, 3, 2]
```

### inverseFilter

```js
/**
 * @type {boolean}
 * @default false
 */
```

Если параметр равен `true`, то успешной операций фильтра является та, для которой он вернул «отрицательное» значение.

```js
$C().addFilter({
	'foo1': function (el) { return el > 1; },
	'foo2': function (el) { return el < 4; }
});

$C([1, 2, 3, 4]).get('foo1 && foo2') // [2, 3]
$C([1, 2, 3, 4]).get({filter: 'foo1 && foo2', inverseFilter: true}) // [1, 4]
```

### notOwn

```js
/**
 * @type {(boolean|number)}
 * @default false
 */
```

Если параметр равен `true`, то в случае итераций по объекту не делается проверка на `hasOwnProperty`, а если параметр равен `-1`,
то итерации идут только по тем элементам, для которых `hasOwnProperty(key) === false`.

```js
var obj = Object.create({foo: 1});
obj.bar = 2;

$C(obj).get() // [2]
$C(obj).get({notOwn: true}) // [1, 2]
$C(obj).get({notOwn: -1}) // [1]
```

### live

```js
/**
 * @type {boolean}
 * @default false
 */
```

Если параметр равен `true`, то в случае итерации по массивам, массиво-подобным объектам, Map и Set не кеширируется начальная длина.

Данный параметр не будет работать совместно с [reverse](https://github.com/kobezzza/Collection/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8%D1%82%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2#reverse).

```js
$C([1]).get(function (el, i, data) {
	if (el === 1) {
		data.push(2);
	}    

	return true;
}) // [1]

$C([1]).get({filter: function (el, i, data) {
	if (el === 1) {
		data.push(2);
	}    

	return true;
}, live: true}) // [1, 2]
```

### use

```js
/**
 * @type {string}
 */
```

Параметр **use** явно декларирует тип используемого цикла для итераций по заданному объекту. Всего доступно 3 вида циклов:

1. `for` — применяется по умолчанию для массивов и массиво-подобных объектов;
2. `for of` — применяется по умолчанию для объектов, который реализуют протокол `@@iterator` и генераторов;
3. `for in` — применяется по умолчанию для всех остальных объектов.

```js
$C({0: 1, 1: 2, length: 2}).get() // [1, 2]
$C({0: 1, 1: 2, length: 2}).get({use: 'for in'}) // [1, 2, 2]

function *i() {
	for (let i = 0; i < 3; i++) {
		yield i;
	}
}

$C(i()).get({use: 'for of'}) // [0, 1, 2]
```

### vars

```js
/**
 * @type {Object}
 */
```

Параметр *vars* позволяет задать дополнительные переменные, значение которых потом можно получить через getVar.

```js
$C([1, 2, 3, 4]).get({
	filter: function (el) {
		return el !== this.getVar('foo');
	},

	vars: {
		foo: 1
	}
}) // [2, 3, 4]

// Внутри строковых сокращений можно использовать более удобный синтаксис
$C([1, 2, 3, 4]).get({
	filter: ':el !== #{foo}', // также можно использовать форму ${foo}

	vars: {
		'foo': 1
	}
}) // [2, 3, 4]
```

### context

```js
/**
 * @type {?}
 * @typedef $$CollectionLink
 */
```

Параметр **context** позволяет задать дополнительный контекст для обхода. Для задания контекста используется [механизм указателей Collection](https://github.com/kobezzza/Collection/wiki/%D0%A3%D0%BA%D0%B0%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D0%B8).

```js
$C({foo: [1, 2, 3]}).get({context: 'foo'}); // [1, 2, 3]
$C({foo: {my: [1, 2, 3]}}).get({
	filter: function (el) { return el > 1; }, 
	context: 'foo > my'
}); // [2, 3]
```

### chain

```js
/**
 * @type {boolean}
 * @default false
 */
```

Если параметр равен `true`, то метод вернёт ссылку на исходный экземпляр Collection, а полученное значение будет установлено активным.

```js
$C([1, 2, 3]).map(function (el) { return el * 2; }, {chain: true}).get() // [2, 4, 6]
```